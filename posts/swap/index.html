<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Swap | Blog</title><meta name=keywords content><meta name=description content="Szükség van-e swap-ra? Erre a kérdésre kerestem a választ és találtam egy jó cikket, amely ezt a témát járja körbe: Linux Performance: Why You Should Almost Always Add Swap Space
Az alábbiakban leírom, hogyan tudunk swap fájlt létrehozni és milyen finomhangolási lehetőségeink vannak.
Swap fájl létrehozása és használata   Swapfájl létrehozása. Például 512 mb-os swapfájl létrehozása:
sudo dd if=/dev/zero of=/swapfile bs=1M count=512 status=progress A dd a coreutils GNU csomag része."><meta name=author content><link rel=canonical href=https://thomastrinn.github.io/blog/posts/swap/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://thomastrinn.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://thomastrinn.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://thomastrinn.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://thomastrinn.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://thomastrinn.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.96.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Swap"><meta property="og:description" content="Szükség van-e swap-ra? Erre a kérdésre kerestem a választ és találtam egy jó cikket, amely ezt a témát járja körbe: Linux Performance: Why You Should Almost Always Add Swap Space
Az alábbiakban leírom, hogyan tudunk swap fájlt létrehozni és milyen finomhangolási lehetőségeink vannak.
Swap fájl létrehozása és használata   Swapfájl létrehozása. Például 512 mb-os swapfájl létrehozása:
sudo dd if=/dev/zero of=/swapfile bs=1M count=512 status=progress A dd a coreutils GNU csomag része."><meta property="og:type" content="article"><meta property="og:url" content="https://thomastrinn.github.io/blog/posts/swap/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-23T15:29:52+02:00"><meta property="article:modified_time" content="2022-04-23T15:29:52+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Swap"><meta name=twitter:description content="Szükség van-e swap-ra? Erre a kérdésre kerestem a választ és találtam egy jó cikket, amely ezt a témát járja körbe: Linux Performance: Why You Should Almost Always Add Swap Space
Az alábbiakban leírom, hogyan tudunk swap fájlt létrehozni és milyen finomhangolási lehetőségeink vannak.
Swap fájl létrehozása és használata   Swapfájl létrehozása. Például 512 mb-os swapfájl létrehozása:
sudo dd if=/dev/zero of=/swapfile bs=1M count=512 status=progress A dd a coreutils GNU csomag része."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://thomastrinn.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"Swap","item":"https://thomastrinn.github.io/blog/posts/swap/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Swap","name":"Swap","description":"Szükség van-e swap-ra? Erre a kérdésre kerestem a választ és találtam egy jó cikket, amely ezt a témát járja körbe: Linux Performance: Why You Should Almost Always Add Swap Space\nAz alábbiakban leírom, hogyan tudunk swap fájlt létrehozni és milyen finomhangolási lehetőségeink vannak.\nSwap fájl létrehozása és használata   Swapfájl létrehozása. Például 512 mb-os swapfájl létrehozása:\nsudo dd if=/dev/zero of=/swapfile bs=1M count=512 status=progress A dd a coreutils GNU csomag része.","keywords":[],"articleBody":"Szükség van-e swap-ra? Erre a kérdésre kerestem a választ és találtam egy jó cikket, amely ezt a témát járja körbe: Linux Performance: Why You Should Almost Always Add Swap Space\nAz alábbiakban leírom, hogyan tudunk swap fájlt létrehozni és milyen finomhangolási lehetőségeink vannak.\nSwap fájl létrehozása és használata   Swapfájl létrehozása. Például 512 mb-os swapfájl létrehozása:\nsudo dd if=/dev/zero of=/swapfile bs=1M count=512 status=progress A dd a coreutils GNU csomag része.\n  Megfelelő jogosultságokat kell adnunk a fájlnak. Csak a root felhasználó számára lehet olvasható és írható. Ez a következőképp tehető meg:\nsudo chmod 600 /swapfile   A fájlt formáznunk kell:\nsudo mkswap /swapfile   Most már engedélyezhetjük, használhatjuk swapfájlként:\nsudo swapon /swapfile   Végül pedig, hogy boot során is engedélyezett legyen fel kell vennünk az /etc/fstab fájlba:\nsudo bash -c \"echo /swapfile none swap defaults 0 0  /etc/fstab\"   Ez a módszer BTRFS és ZFS fájlrendszer esetén nem fog működni.\nFinomhangolás Két paraméter segítségével finomhangolhatjuk a rendszer memória és swap kezelését:\n  swappiness: Ezzel szabályozható, hogy mekkora valószínűséggel kerüljön át egy page a swap-ra. Ez az érték a szabad memória százalékos arányát jelenti mielőtt aktiválódik a swap. Az alapértelmezett érték 60, ami ideális szerverek esetén, asztali számítógépek esetén az ajánlott érték 10.\n  vfs_cache_pressure: Ez egy százalékos érték, amely szabályozza a kernel azon tendenciáját, hogy visszafoglalja a könyvtár- és inode objektumok cache-elésére használt memóriát. Alapértéke 100 a 5.4-es kernel verzió előtt. Az 5.4 vagy újabb kernelek esetén értéke növelhető 100 fölé. Ezen érték növelése növeli az objektumok eltávolításának mértékét a memória cache-ből. Ennek csökkentése lehetővé teszi, hogy ezek az objektumok hosszabb ideig legyenek cache-elve a memóriában. Az ajánlott érték 50-től 200-ig tartományban.\n  Amennyiben elegendő memória áll rendelkezésünkre, akár szerver akár személyi számítógép esetén a következő beállítások megfelelőek lehetnek:\nvm.swappiness=10 vm.vfs_cache_pressure=50 Ezen változók aktuális értékének lekérdezése az alábbi módon tehető meg:\nsudo cat /proc/sys/vm/swappiness sudo cat /proc/sys/vm/vfs_cache_pressure Ezen értékek ideiglenes beállítása:\nsudo sysctl -w vm.swappiness=10 sudo sysctl -w vm.vfs_cache_pressure=50 Ahhoz, hogy permanenssé tegyük a beállítást egy sysctl.d config fájlt kell létrehoznunk. Például hozzunk létre egy /etc/sysctl.d/99-swap.conf fájlt:\nvm.swappiness=10 vm.vfs_cache_pressure=50  sysctl.d - Configure kernel parameters at boot\n Swap fájl törlése Swap fájl törlése előtt először ki kell kapcsolni a swap fájl használatát:\nswapoff /swapfile rm -f /swapfile És végül törölni kell az /etc/fstab fájlból a hozzá tartozó bejegyzést.\n","wordCount":"369","inLanguage":"en","datePublished":"2022-04-23T15:29:52+02:00","dateModified":"2022-04-23T15:29:52+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://thomastrinn.github.io/blog/posts/swap/"},"publisher":{"@type":"Organization","name":"Blog","logo":{"@type":"ImageObject","url":"https://thomastrinn.github.io/blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://thomastrinn.github.io/blog/ accesskey=h title="Blog (Alt + H)">Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://thomastrinn.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://thomastrinn.github.io/blog/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://thomastrinn.github.io/blog/series/ title=Series><span>Series</span></a></li><li><a href=https://thomastrinn.github.io/blog/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://thomastrinn.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://thomastrinn.github.io/blog/posts/>Posts</a></div><h1 class=post-title>Swap</h1><div class=post-meta><span title="2022-04-23 15:29:52 +0200 CEST">April 23, 2022</span></div></header><div class=post-content><p>Szükség van-e swap-ra? Erre a kérdésre kerestem a választ és találtam egy jó cikket, amely ezt a témát járja körbe: <a href=https://haydenjames.io/linux-performance-almost-always-add-swap-space/>Linux Performance: Why You Should Almost Always Add Swap Space</a></p><p>Az alábbiakban leírom, hogyan tudunk swap fájlt létrehozni és milyen finomhangolási lehetőségeink vannak.</p><h1 id=swap-fájl-létrehozása-és-használata>Swap fájl létrehozása és használata<a hidden class=anchor aria-hidden=true href=#swap-fájl-létrehozása-és-használata>#</a></h1><ol><li><p>Swapfájl létrehozása. Például 512 mb-os swapfájl létrehozása:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>/swapfile bs<span style=color:#f92672>=</span>1M count<span style=color:#f92672>=</span><span style=color:#ae81ff>512</span> status<span style=color:#f92672>=</span>progress
</span></span></code></pre></div><p>A <a href=https://wiki.archlinux.org/title/Dd>dd</a> a <code>coreutils</code> GNU csomag része.</p></li><li><p>Megfelelő jogosultságokat kell adnunk a fájlnak. Csak a <code>root</code> felhasználó számára lehet olvasható és írható. Ez a következőképp tehető meg:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chmod <span style=color:#ae81ff>600</span> /swapfile
</span></span></code></pre></div></li><li><p>A fájlt formáznunk kell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkswap /swapfile
</span></span></code></pre></div></li><li><p>Most már engedélyezhetjük, használhatjuk swapfájlként:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo swapon /swapfile
</span></span></code></pre></div></li><li><p>Végül pedig, hogy boot során is engedélyezett legyen fel kell vennünk az <code>/etc/fstab</code> fájlba:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo bash -c <span style=color:#e6db74>&#34;echo /swapfile none swap defaults 0 0 &gt;&gt; /etc/fstab&#34;</span>
</span></span></code></pre></div></li></ol><p>Ez a módszer BTRFS és ZFS fájlrendszer esetén nem fog működni.</p><h1 id=finomhangolás>Finomhangolás<a hidden class=anchor aria-hidden=true href=#finomhangolás>#</a></h1><p>Két paraméter segítségével finomhangolhatjuk a rendszer memória és swap kezelését:</p><ul><li><p><code>swappiness</code>: Ezzel szabályozható, hogy mekkora valószínűséggel kerüljön át egy page a swap-ra. Ez az érték a szabad memória százalékos arányát jelenti mielőtt aktiválódik a swap. Az alapértelmezett érték 60, ami ideális szerverek esetén, asztali számítógépek esetén az ajánlott érték 10.</p></li><li><p><code>vfs_cache_pressure</code>: Ez egy százalékos érték, amely szabályozza a kernel azon tendenciáját, hogy visszafoglalja a könyvtár- és inode objektumok cache-elésére használt memóriát. Alapértéke 100 a 5.4-es kernel verzió előtt. Az 5.4 vagy újabb kernelek esetén értéke növelhető 100 fölé. Ezen érték növelése növeli az objektumok eltávolításának mértékét a memória cache-ből. Ennek csökkentése lehetővé teszi, hogy ezek az objektumok hosszabb ideig legyenek cache-elve a memóriában. Az ajánlott érték 50-től 200-ig tartományban.</p></li></ul><p>Amennyiben elegendő memória áll rendelkezésünkre, akár szerver akár személyi számítógép esetén a következő beállítások megfelelőek lehetnek:</p><pre tabindex=0><code>vm.swappiness=10
vm.vfs_cache_pressure=50
</code></pre><p>Ezen változók aktuális értékének lekérdezése az alábbi módon tehető meg:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>sudo cat /proc/sys/vm/vfs_cache_pressure
</span></span></code></pre></div><p>Ezen értékek ideiglenes beállítása:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo sysctl -w vm.swappiness<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>sudo sysctl -w vm.vfs_cache_pressure<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>
</span></span></code></pre></div><p>Ahhoz, hogy permanenssé tegyük a beállítást egy sysctl.d config fájlt kell létrehoznunk. Például hozzunk létre egy <code>/etc/sysctl.d/99-swap.conf</code> fájlt:</p><pre tabindex=0><code>vm.swappiness=10
vm.vfs_cache_pressure=50
</code></pre><blockquote><p>sysctl.d - Configure kernel parameters at boot</p></blockquote><h1 id=swap-fájl-törlése>Swap fájl törlése<a hidden class=anchor aria-hidden=true href=#swap-fájl-törlése>#</a></h1><p>Swap fájl törlése előtt először ki kell kapcsolni a swap fájl használatát:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>swapoff /swapfile
</span></span><span style=display:flex><span>rm -f /swapfile
</span></span></code></pre></div><p>És végül törölni kell az <code>/etc/fstab</code> fájlból a hozzá tartozó bejegyzést.</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://thomastrinn.github.io/blog/>Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>